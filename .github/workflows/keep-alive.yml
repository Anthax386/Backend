name: Keep Backend Alive

on:
  schedule:
    # Ping toutes les 10 minutes
    - cron: '*/10 * * * *'
  workflow_dispatch: # Permet de d√©clencher manuellement

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Backend
        run: |
          echo "üîÑ Pinging backend..."
          
          # Premier ping (peut prendre du temps si le backend est endormi)
          HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" --max-time 120 https://backend-teo7.onrender.com/api/health)
          
          if [ "$HTTP_CODE" = "200" ]; then
            echo "‚úÖ Backend is alive! (HTTP $HTTP_CODE)"
          else
            echo "‚ö†Ô∏è  First ping returned HTTP $HTTP_CODE, waiting 10 seconds..."
            sleep 10
            
            # Deuxi√®me tentative
            HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" --max-time 60 https://backend-teo7.onrender.com/api/health)
            
            if [ "$HTTP_CODE" = "200" ]; then
              echo "‚úÖ Backend is now awake! (HTTP $HTTP_CODE)"
            else
              echo "‚ùå Backend still not responding (HTTP $HTTP_CODE)"
              exit 1
            fi
          fi